/*! by da宗熊 MIT v1.0.0 update:2017/0/9 git:https://github.com/linfenpan/filter-select */
!function(e,t,n){e[t]=n(e)}(window,"FilterSelect",function(e){function t(e,t,n){var i=e.getElementsByTagName(t);return n===p?i:i[n]}function n(e,t,n){return n===p?e.getAttribute(t):void e.setAttribute(t,n)}function i(e,t){if("string"==typeof t)return e.style[t];var n=t;for(var i in n)n.hasOwnProperty(i)&&(e.style[i]=n[i])}function l(e,t){e.className=e.className.replace(new RegExp("\\s*\\b"+t+"\\b","g"),"")}function a(e,t){return new RegExp("\\b"+t+"\\b").test(e.className)}function o(e,t){a(e,t)||(e.className+=" "+t)}function r(e,t){for(var n=0,i=e.length;n<i;n++)t.call(e,e[n],n)}function s(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function u(){for(var e=[].slice.call(arguments,0),t=e[0],n=1,i=e.length;n<i;n++){var l=e[n];for(var a in l)l.hasOwnProperty(a)&&(t[a]=l[a])}return t}function c(e){return e.replace(/^\s*|\s*$/g,"")}function d(e,t,n){window.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function v(e,t,n){window.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)}function f(e,i){var l=this;l.$select=e,i=l.options=u({callback:function(e,t){},resetCallback:function(e){},clearAtFocus:!0,freeInput:!1,placeholder:"请选择"},i||{});var a=l.$root=document.createElement("div");a.innerHTML=['<div class="m-placeholder" style="display:none;"></div>','<input type="text" class="m-input" autocomplete="false" disableautocomplete value="" />','<input type="hidden" class="m-input-hidden" autocomplete="false" disableautocomplete value="" />','<span class="m-input-ico"></span>','<ul class="m-list" style="display:none;"></ul>'].join(""),o(a,"m-input-select"),n(a,"autocomplete","off"),e.parentNode.insertBefore(a,e),l.$input=t(a,"input",0),l.$value=t(a,"input",1),l.$ico=t(a,"span",0),l.$tip=t(a,"div",0),l.$ul=t(a,"ul",0),l.init()}var p=void 0,h="m-list-item-active";return f.prototype={init:function(){var e=this;e.setPlaceholder(e.options.placeholder),e.reset(),e._f1()},reset:function(){var e=this;e.index=0,e.isShow=!1;var n,l,a=[];r(t(e.$select,"option"),function(e){var t=c(e.innerHTML),i=e.value;i=i||!e.outerHTML||/\svalue=/i.test(e.outerHTML)?i:t,a.push('<li class="m-list-item" data-value="'+i+'">'+t+"</li>"),e.selected&&(n=i,l=t)}),e.$ul.innerHTML=a.join(""),i(e.$ul,{display:"none"}),i(e.$select,{display:"none"}),e.$lis=t(e.$ul,"li"),e.length=e.$lis.length,e.$input.value=l,e.$tip.value=l;var o=e.options.freeInput?l:n;e._f2(o),e._f3=o,l?e.setPlaceholder(l):e._f4(),setTimeout(function(){e.$select.value!=e.$value.value?e.reset():e.options.resetCallback(o,l)})},setPlaceholder:function(e){this.$tip.innerHTML=e},_f5:function(){i(this.$tip,{display:"none"})},_f4:function(){i(this.$tip,{display:"block"})},_f1:function(){function e(){return!l.disabled&&!l.readOnly}function t(t,i){if((!t.propertyName||"value"==t.propertyName.toLowerCase())&&e()){var a=c(l.value);a?n._f5():n._f4(),n.filterByValue(a),n.show()}}var n=this,i=n.options,l=n.$input;d(n.$ul,"click",function(e){var t=e.srcElement||e.target,i=t.tagName.toLowerCase();"li"==i&&(n._f6(s(n.$lis,t),!0),n.hide())}),d(n.$ico,"click",function(){e()&&(n.isShow?n.hide():(l.focus(),n.show()))}),d(l,"focus",function(a){e()&&((i.clearAtFocus||i.freeInput&&this.value==i.placeholder)&&(l.value="",n._f4()),t.call(this,a))}),d(l,"keydown",function(t){if(e())switch(t.keyCode){case 38:n.prev();break;case 40:n.next();break;case 13:n._f6(n._f7(),!0),n.hide()}}),d(l,"input",t),setTimeout(function(){d(l,"propertychange",t)},200)},filterByValue:function(e){var t=this,n=t.$lis;e=c(e||"").toLowerCase(),r(n,function(t){var n=c(t.innerHTML).toLowerCase();l(t,h),i(t,{display:n.indexOf(e)>=0?"block":"none"})});var a=t._f8();if(a>=0)o(n[a],h);else{var s=t._f9();s>=0&&o(n[s],h)}},_f10:function(){var e=this,t=e.$ul,n=e.$lis;t.scrollTop=n[0].clientHeight*e._f11()},_f6:function(e,t){var a=this,r=a.$lis,s=a._f12();e<0?e=0:e>=s&&(e=s-1);var u=a._f7();u>=0&&l(r[u],h);for(var c,d=0,v=0;v<a.length;v++){var f=r[v];if("none"!=i(f,"display")){if(d==e){o(f,h),c=f;break}d++}}if(c&&(a._f10(),a.index=e,t)){var p=c.innerHTML,$=n(c,"data-value"),_=a.options;a.$input.value=p,a._f2(_.freeInput?p:$),a.$tip.innerHTML=p,a._f5()}},_f12:function(){var e=0;return r(this.$lis,function(t){var n=i(t,"display");"none"!=n&&e++}),e},_f7:function(){for(var e=this,t=-1,n=0;n<e.length;n++){var l=e.$lis[n];if(a(l,h)&&"none"!=i(l,"display"))return n}return t},_f8:function(){for(var e=this,t=-1,l=e.getValue(),a=0;a<e.length;a++){var o=e.$lis[a];if(l==n(o,"data-value")&&"none"!=i(o,"display"))return a}return t},_f11:function(){for(var e=this,t=0,n=0;n<e.length;n++){var l=e.$lis[n];if("none"!=i(l,"display")){if(a(l,h))return t;t++}}return t},_f9:function(){for(var e=this,t=0;t<e.length;t++){var n=e.$lis[t];if("none"!=i(n,"display"))return t}return-1},next:function(){return this._f6(this.index+1)},prev:function(){return this._f6(this.index-1)},hide:function(){var e=this,t=c(e.$input.value);e.options.freeInput&&t?(e._f2(t),e.setPlaceholder(t)):(e.$input.value=e.$tip.innerHTML,e._f5()),i(e.$ul,{display:"none"}),e.isShow=!1,e._f13()},show:function(){var e=this;i(e.$ul,{display:"block"}),e.isShow=!0,e.index=e._f11(),e._f10(),e._f14()},getValue:function(){var e=this,t=e.options;return c(t.freeInput?e.$input.value:e.$value.value)},setValue:function(e){var t=this;t._f2(e);for(var i=0,l=t.length;i<l;i++){var a=t.$lis[i],o=n(a,"data-value");if(o==e)return t.$input.value=o,void t.setPlaceholder(o)}t.$input.value=e,t.setPlaceholder(e)},_f2:function(e){var t=this;t.$value.value=e,t.$select.value=e,n(t.$select,"data-value",e)},setDisabled:function(e){this.$input.disabled=e},_f14:function(){function e(t){if(!n.$ul)return void v(i,"click",e);var l=t.srcElement||t.target;l!=n.$input&&l!=n.$ico&&(n.hide(),v(i,"click",e))}function t(){v(i,"click",e),d(i,"click",e)}var n=this,i=document.getElementsByTagName("body")[0];n._f14=t,t()},_f3:null,_f13:function(){var e=this,t=e.getValue();e._f3!==t&&(e._f3=t,e.options.callback(t,c(e.$input.value)))}},f});