/*! by da宗熊 MIT v1.0.0 update:2017/0/12 git:https://github.com/linfenpan/filter-select */
!function(e,t,n){e[t]=n(e)}(window,"FilterSelect",function(e){function t(e,t,n){var i=e.getElementsByTagName(t);return n===v?i:i[n]}function n(e,t,n){return n===v?e.getAttribute(t):void e.setAttribute(t,n)}function i(e,t){if("string"==typeof t)return e.style[t];var n=t;for(var i in n)n.hasOwnProperty(i)&&(e.style[i]=n[i])}function l(e,t){e.className=e.className.replace(new RegExp("\\s*\\b"+t+"\\b","g"),"")}function a(e,t){return new RegExp("\\b"+t+"\\b").test(e.className)}function o(e,t){a(e,t)||(e.className+=" "+t)}function r(e,t){for(var n=0,i=e.length;n<i;n++)t.call(e,e[n],n)}function s(){for(var e=[].slice.call(arguments,0),t=e[0],n=1,i=e.length;n<i;n++){var l=e[n];for(var a in l)l.hasOwnProperty(a)&&(t[a]=l[a])}return t}function u(e){return e.replace(/^\s*|\s*$/g,"")}function c(e,t,n){window.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function d(e,t,n){window.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)}function f(e,i){var l=this;l.$select=e,i=l.options=s({callback:function(e,t){},resetCallback:function(e){},clearAtFocus:!0,freeInput:!1,placeholder:"请选择"},i||{});var a=l.$root=document.createElement("div");a.innerHTML=['<div class="m-placeholder" style="display:none;"></div>','<input type="text" class="m-input" autocomplete="off" disableautocomplete value="" />','<input type="hidden" class="m-input-hidden" autocomplete="off" disableautocomplete value="" />','<span class="m-input-ico"></span>','<ul class="m-list" style="display:none;"></ul>'].join(""),o(a,"m-input-select"),n(a,"autocomplete","off"),e.parentNode.insertBefore(a,e),l.$input=t(a,"input",0),l.$value=t(a,"input",1),l.$ico=t(a,"span",0),l.$tip=t(a,"div",0),l.$ul=t(a,"ul",0),l._f1()}var v=void 0,p="m-list-item-active";return f.prototype={_f1:function(){var e=this;e.setPlaceholder(e.options.placeholder),e.reset(),e._f2()},reset:function(){var e=this;e._f3=0,e.isShow=!1;var l,a,o=[];r(t(e.$select,"option"),function(e){var t=u(e.innerHTML),n=e.value;n=n||!e.outerHTML||/\svalue=/i.test(e.outerHTML)?n:t,o.push('<li class="m-list-item" data-value="'+n+'">'+t+"</li>"),e.selected&&(l=n,a=t)}),e.$ul.innerHTML=o.join(""),i(e.$ul,{display:"none"}),i(e.$select,{display:"none"}),n(e.$select,"autocomplete","off"),e.$lis=t(e.$ul,"li"),e.length=e.$lis.length;var s=e.options.freeInput?a:l;e._f4=s,e.setValue(s),a||e._f5(),e.options.resetCallback(s,a)},setPlaceholder:function(e){this.$tip.innerHTML=e},_f6:function(){i(this.$tip,{display:"none"})},_f5:function(){i(this.$tip,{display:"block"})},_f2:function(){function e(){return!l.disabled&&!l.readOnly}function t(t,i){if((!t.propertyName||"value"==t.propertyName.toLowerCase())&&e()){var a=u(l.value);a?n._f6():n._f5(),n.filterByValue(a),n.show()}}var n=this,i=n.options,l=n.$input;c(n.$ul,"click",function(e){var t=e.srcElement||e.target,i=t.tagName.toLowerCase();"li"==i&&(n._f7(t),n.hide())}),c(n.$ico,"click",function(){e()&&(n.isShow?n.hide():(l.focus(),n.show()))}),c(l,"focus",function(n){e()&&((i.clearAtFocus||i.freeInput&&this.value==i.placeholder)&&(l.value=""),t.call(this,n))}),c(l,"keydown",function(t){if(e())switch(t.keyCode){case 38:n.prev();break;case 40:n.next();break;case 13:n._f7(n.$lis[n._f8()]),n.hide()}}),c(l,"input",t),setTimeout(function(){c(l,"propertychange",t)},200)},filterByValue:function(e){var t=this,n=(t.options,t.$lis);e=u(e||"").toLowerCase(),r(n,function(t){var n=u(t.innerHTML).toLowerCase();l(t,p),i(t,{display:n.indexOf(e)>=0?"block":"none"})});var a=t._f9();if(a>=0)o(n[a],p);else{var s=t._f10();s>=0&&o(n[s],p)}},_f11:function(){var e=this,t=e.$ul,n=e.$lis,i=e._f10();t.scrollTop=i>=0?n[i].clientHeight*e._f12():0},_f13:function(e){var t=this,n=t.$lis,a=t._f14();e<0?e=0:e>=a&&(e=a-1);var r=t._f8();r>=0&&l(n[r],p);for(var s,u=0,c=0;c<t.length;c++){var d=n[c];if("none"!=i(d,"display")){if(u==e){o(d,p),s=d;break}u++}}s&&(t._f11(),t._f3=e)},_f7:function(e){var t,i,a=this,r=a.options.freeInput;if(e){t=e.innerHTML,i=n(e,"data-value");var s=a.$lis[a._f8()];s&&l(s,p),o(e,p)}else t=i=a.getValue();a.setValue(r?t:i)},_f14:function(){var e=0;return r(this.$lis,function(t){var n=i(t,"display");"none"!=n&&e++}),e},_f8:function(){for(var e=this,t=-1,n=0;n<e.length;n++){var i=e.$lis[n];if(a(i,p))return n}return t},_f9:function(){for(var e=this,t=-1,l=e.$value.value,a=0;a<e.length;a++){var o=e.$lis[a];if(l==n(o,"data-value")&&"none"!=i(o,"display"))return a}return t},_f12:function(){for(var e=this,t=0,n=0;n<e.length;n++){var l=e.$lis[n];if("none"!=i(l,"display")){if(a(l,p))return t;t++}}return 0},_f10:function(){for(var e=this,t=0;t<e.length;t++){var n=e.$lis[t];if("none"!=i(n,"display"))return t}return-1},next:function(){return this._f13(this._f3+1)},prev:function(){return this._f13(this._f3-1)},hide:function(){var e=this,t=u(e.$input.value);e.options.freeInput&&t?(e._f15(t),e.setPlaceholder(t)):(e.$input.value=e.$tip.innerHTML,e._f6()),i(e.$ul,{display:"none"}),e.isShow=!1,e._f16()},show:function(){var e=this;i(e.$ul,{display:"block"}),e.isShow=!0,e._f3=e._f12(),e._f11(),e._f17()},getValue:function(){var e=this,t=e.options;return u(t.freeInput?e.$input.value:e.$value.value)},setValue:function(e){var t=this;t._f15(e),e&&t._f6();for(var i=!1,l=0,a=t.length;l<a;l++){var o=t.$lis[l],r=n(o,"data-value");if(r==e){var s=u(o.innerHTML);t.$input.value=s,t.setPlaceholder(s),i=!0;break}}i||(t.$input.value=e,t.setPlaceholder(e)),t._f4!=e&&t._f16()},_f15:function(e){var t=this;t.$value.value=e,t.$select.value=e,n(t.$select,"data-value",e)},setDisabled:function(e){this.$input.disabled=e},_f17:function(){function e(t){if(!n.$ul)return void d(l,i,e);var a=t.srcElement||t.target;"li"===a.tagName.toLowerCase()&&(a=a.parentNode),a!=n.$input&&a!=n.$ico&&a!=n.$ul&&(n.hide(),d(l,i,e))}function t(){d(l,i,e),c(l,i,e)}var n=this,i="mouseup",l=document.getElementsByTagName("body")[0];n._f17=t,t()},_f4:null,_f16:function(){var e=this,t=e.getValue();e._f4!==t&&(e._f4=t,e.options.callback(t,u(e.$input.value)))}},f});