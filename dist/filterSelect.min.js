/*! by da宗熊 MIT v1.0.0 update:2017/0/9 git:https://github.com/linfenpan/filter-select */
!function(e,t,n){e[t]=n(e)}(window,"FilterSelect",function(e){function t(e,t,n){var i=e.getElementsByTagName(t);return n===p?i:i[n]}function n(e,t,n){return n===p?e.getAttribute(t):void e.setAttribute(t,n)}function i(e,t){if("string"==typeof t)return e.style[t];var n=t;for(var i in n)n.hasOwnProperty(i)&&(e.style[i]=n[i])}function l(e,t){e.className=e.className.replace(new RegExp("\\s*\\b"+t+"\\b","g"),"")}function o(e,t){return new RegExp("\\b"+t+"\\b").test(e.className)}function a(e,t){o(e,t)||(e.className+=" "+t)}function r(e,t){for(var n=0,i=e.length;n<i;n++)t.call(e,e[n],n)}function s(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function u(){for(var e=[].slice.call(arguments,0),t=e[0],n=1,i=e.length;n<i;n++){var l=e[n];for(var o in l)l.hasOwnProperty(o)&&(t[o]=l[o])}return t}function c(e){return e.replace(/^\s*|\s*$/g,"")}function d(e,t,n){window.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function v(e,t,n){window.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)}function f(e,i){var l=this;l.$select=e,i=l.options=u({callback:function(e,t){},resetCallback:function(e){},clearAtFocus:!0,freeInput:!1,placeholder:"请选择"},i||{});var o=l.$root=document.createElement("div");o.innerHTML=['<div class="m-placeholder" style="display:none;"></div>','<input type="text" class="m-input" autocomplete="false" disableautocomplete value="" />','<input type="hidden" class="m-input-hidden" autocomplete="false" disableautocomplete value="" />','<span class="m-input-ico"></span>','<ul class="m-list" style="display:none;"></ul>'].join(""),a(o,"m-input-select"),n(o,"autocomplete","off"),e.parentNode.insertBefore(o,e),l.$input=t(o,"input",0),l.$value=t(o,"input",1),l.$ico=t(o,"span",0),l.$tip=t(o,"div",0),l.$ul=t(o,"ul",0),l.init()}var p=void 0,h="m-list-item-active";return f.prototype={init:function(){var e=this;e.setPlaceholder(e.options.placeholder),e.reset(),e._f1()},reset:function(){var e=this;e.index=0,e.isShow=!1;var n,l,o=[];r(t(e.$select,"option"),function(e){var t=c(e.innerHTML),i=e.value;i=i||!e.outerHTML||/\svalue=/i.test(e.outerHTML)?i:t,o.push('<li class="m-list-item" data-value="'+i+'">'+t+"</li>"),e.selected&&(n=i,l=t)}),e.$ul.innerHTML=o.join(""),i(e.$ul,{display:"none"}),i(e.$select,{display:"none"}),e.$lis=t(e.$ul,"li"),e.length=e.$lis.length,e.$input.value=l,e.$tip.value=l;var a=e.options.freeInput?l:n;e.setValue(a),e._f2=a,l?e.setPlaceholder(l):e._f3(),setTimeout(function(){e.$select.value!=e.$value.value?e.reset():e.options.resetCallback(a,l)})},setPlaceholder:function(e){this.$tip.innerHTML=e},_f4:function(){i(this.$tip,{display:"none"})},_f3:function(){i(this.$tip,{display:"block"})},_f1:function(){function e(e){var n=c(t.$input.value);n?t._f4():t._f3(),t.filterByValue(n),t.show()}var t=this,n=t.options;d(t.$ul,"click",function(e){var n=e.srcElement||e.target,i=n.tagName.toLowerCase();"li"==i&&(t._f5(s(t.$lis,n),!0),t.hide())}),d(t.$ico,"click",function(){t.isShow?t.hide():(t.$input.focus(),t.show())}),d(t.$input,"focus",function(i){(n.clearAtFocus||n.freeInput&&this.value==n.placeholder)&&(t.$input.value="",t._f3()),e.call(this,i)}),d(t.$input,"keydown",function(e){switch(e.keyCode){case 38:t.prev();break;case 40:t.next();break;case 13:t._f5(t._f6(),!0),t.hide()}}),d(t.$input,"input",e),setTimeout(function(){d(t.$input,"propertychange",e)},200)},filterByValue:function(e){var t=this,n=t.$lis;e=c(e||"").toLowerCase(),r(n,function(t){var n=c(t.innerHTML).toLowerCase();l(t,h),i(t,{display:n.indexOf(e)>=0?"block":"none"})});var o=t._f7();if(o>=0)a(n[o],h);else{var s=t._f8();s>=0&&a(n[s],h)}},_f9:function(){var e=this,t=e.$ul,n=e.$lis;t.scrollTop=n[0].clientHeight*e._f10()},_f5:function(e,t){var o=this,r=o.$lis,s=o._f11();e<0?e=0:e>=s&&(e=s-1);var u=o._f6();u>=0&&l(r[u],h);for(var c,d=0,v=0;v<o.length;v++){var f=r[v];if("none"!=i(f,"display")){if(d==e){a(f,h),c=f;break}d++}}if(c&&(o._f9(),o.index=e,t)){var p=c.innerHTML,$=n(c,"data-value"),g=o.options;o.$input.value=p,o.setValue(g.freeInput?p:$),o.$tip.innerHTML=p,o._f4()}},_f11:function(){var e=0;return r(this.$lis,function(t){var n=i(t,"display");"none"!=n&&e++}),e},_f6:function(){for(var e=this,t=-1,n=0;n<e.length;n++){var l=e.$lis[n];if(o(l,h)&&"none"!=i(l,"display"))return n}return t},_f7:function(){for(var e=this,t=-1,l=e.getValue(),o=0;o<e.length;o++){var a=e.$lis[o];if(l==n(a,"data-value")&&"none"!=i(a,"display"))return o}return t},_f10:function(){for(var e=this,t=0,n=0;n<e.length;n++){var l=e.$lis[n];if("none"!=i(l,"display")){if(o(l,h))return t;t++}}return t},_f8:function(){for(var e=this,t=0;t<e.length;t++){var n=e.$lis[t];if("none"!=i(n,"display"))return t}return-1},next:function(){return this._f5(this.index+1)},prev:function(){return this._f5(this.index-1)},hide:function(){var e=this,t=c(e.$input.value);e.options.freeInput&&t?(e.setValue(t),e.setPlaceholder(t)):(e.$input.value=e.$tip.innerHTML,e._f4()),i(e.$ul,{display:"none"}),e.isShow=!1,e._f12()},show:function(){var e=this;i(e.$ul,{display:"block"}),e.isShow=!0,e.index=e._f10(),e._f9(),e._f13()},getValue:function(){var e=this,t=e.options;return c(t.freeInput?e.$input.value:e.$value.value)},setValue:function(e){var t=this;t.$value.value=e,t.$select.value=e,n(t.$select,"data-value",e)},_f13:function(){function e(t){if(!n.$ul)return void v(i,"click",e);var l=t.srcElement||t.target;l!=n.$input&&l!=n.$ico&&(n.hide(),v(i,"click",e))}function t(){v(i,"click",e),d(i,"click",e)}var n=this,i=document.getElementsByTagName("body")[0];n._f13=t,t()},_f2:null,_f12:function(){var e=this,t=e.getValue();e._f2!==t&&(e._f2=t,e.options.callback(t,c(e.$input.value)))}},f});