/*! by da宗熊 MIT v1.0.0 update:2017/0/8 git:https://github.com/linfenpan/filter-select*/
!function(e,t,n){e[t]=n(e)}(window,"FilterSelect",function(e){function t(e,t,n){var i=e.getElementsByTagName(t);return n===p?i:i[n]}function n(e,t,n){return n===p?e.getAttribute(t):void e.setAttribute(t,n)}function i(e,t){if("string"==typeof t)return e.style[t];var n=t;for(var i in n)n.hasOwnProperty(i)&&(e.style[i]=n[i])}function l(e,t){e.className=e.className.replace(new RegExp("\\s*\\b"+t+"\\b","g"),"")}function r(e,t){return new RegExp("\\b"+t+"\\b").test(e.className)}function o(e,t){r(e,t)||(e.className+=" "+t)}function a(e,t){for(var n=0,i=e.length;n<i;n++)t.call(e,e[n],n)}function s(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function u(){for(var e=[].slice.call(arguments,0),t=e[0],n=1,i=e.length;n<i;n++){var l=e[n];for(var r in l)l.hasOwnProperty(r)&&(t[r]=l[r])}return t}function c(e){return e.replace(/^\s*|\s*$/g,"")}function d(e,t,n){window.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function v(e,t,n){window.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)}function f(e,n){var i=this;i.$select=e,n=i.options=u({callback:function(e,t){},clearAtFocus:!0,freeInput:!1,placeholder:"请选择"},n||{});var l=i.$root=document.createElement("div");l.innerHTML=['<div class="m-placeholder"></div>','<input type="text" class="m-input" />','<input type="hidden" class="m-input-hidden" />','<span class="m-input-ico"></span>','<ul class="m-list"></ul>'].join(""),o(l,"m-input-select"),e.parentNode.insertBefore(l,e),i.$input=t(l,"input",0),i.$value=t(l,"input",1),i.$ico=t(l,"span",0),i.$tip=t(l,"div",0),i.$ul=t(l,"ul",0),i.init()}var p=void 0,h="m-list-item-active";return f.prototype={init:function(){var e=this;e.setPlaceholder(e.options.placeholder),e.reset(),e._f1()},reset:function(){var e=this;e.index=0,e.isShow=!1;var n,l,r=[];a(t(e.$select,"option"),function(e){var t=c(e.innerHTML),i=e.value;i=typeof i===p?t:i,r.push('<li class="m-list-item" data-value="'+i+'">'+t+"</li>"),e.selected&&(n=i,l=t)}),e.$ul.innerHTML=r.join(""),i(e.$ul,{display:"none"}),i(e.$select,{display:"none"}),e.$lis=t(e.$ul,"li"),e.length=e.$lis.length,e.$input.value=l,e.$value.value=e.options.freeInput?l:n,e.$tip.value=l,n&&e.setPlaceholder(l)},setPlaceholder:function(e){this.$tip.innerHTML=e},_f2:function(){i(this.$tip,{display:"none"})},_f3:function(){i(this.$tip,{display:"block"})},_f1:function(){function e(e){this.value?t._f2():t._f3(),t.filterByValue(this.value),t.show()}var t=this,n=t.options;d(t.$ul,"click",function(e){var n=e.srcElement||e.target,i=n.tagName.toLowerCase();"li"==i&&(t._f4(s(t.$lis,n),!0),t.hide())}),d(t.$ico,"click",function(){t.isShow?t.hide():(t.$input.focus(),t.show())}),d(t.$input,"focus",function(i){(n.clearAtFocus||n.freeInput&&this.value==n.placeholder)&&(t.$input.value="",t._f3()),e.call(this,i)}),d(t.$input,"keydown",function(e){switch(e.keyCode){case 38:t.prev();break;case 40:t.next();break;case 13:t._f4(t._f5(),!0),t.hide()}}),d(t.$input,"input",e),d(t.$input,"propertychange",e)},filterByValue:function(e){var t=this,n=t.$lis;e=c(e||"").toLowerCase(),a(n,function(t){var n=c(t.innerHTML).toLowerCase();l(t,h),i(t,{display:n.indexOf(e)>=0?"block":"none"})});var r=t._f6();if(r>=0)o(n[r],h);else{var s=t._f7();s>=0&&o(n[s],h)}},_f8:function(){var e=this,t=e.$ul,n=e.$lis;t.scrollTop=n[0].clientHeight*e._f9()},_f4:function(e,t){var r=this,a=r.$lis,s=r._f10();e<0?e=0:e>=s&&(e=s-1);var u=r._f5();u>=0&&l(a[u],h);for(var c,d=0,v=0;v<r.length;v++){var f=a[v];if("none"!=i(f,"display")){if(d==e){o(f,h),c=f;break}d++}}if(c&&(r._f8(),r.index=e,t)){var p=c.innerHTML,$=n(c,"data-value"),g=r.options;r.$input.value=p,r.$value.value=g.freeInput?p:$,r.$tip.innerHTML=p,r._f2()}},_f10:function(){var e=0;return a(this.$lis,function(t){var n=i(t,"display");"none"!=n&&e++}),e},_f5:function(){for(var e=this,t=-1,n=0;n<e.length;n++){var l=e.$lis[n];if(r(l,h)&&"none"!=i(l,"display"))return n}return t},_f6:function(){for(var e=this,t=-1,l=e.getValue(),r=0;r<e.length;r++){var o=e.$lis[r];if(l==n(o,"data-value")&&"none"!=i(o,"display"))return r}return t},_f9:function(){for(var e=this,t=0,n=0;n<e.length;n++){var l=e.$lis[n];if("none"!=i(l,"display")){if(r(l,h))return t;t++}}return t},_f7:function(){for(var e=this,t=0;t<e.length;t++){var n=e.$lis[t];if("none"!=i(n,"display"))return t}return-1},next:function(){return this._f4(this.index+1)},prev:function(){return this._f4(this.index-1)},hide:function(){var e=this,t=c(e.$input.value);e.options.freeInput?(e.$value.value=t,e.setPlaceholder(t)):(e.$input.value=e.$tip.innerHTML,e._f2()),i(e.$ul,{display:"none"}),e.isShow=!1,e._f11()},show:function(){var e=this;i(e.$ul,{display:"block"}),e.isShow=!0,e.index=e._f9(),e._f8(),e._f12()},getValue:function(){var e=this,t=e.options;return c(t.freeInput?e.$input.value:e.$value.value)},_f12:function(){function e(t){if(!n.$ul)return void v(i,"click",e);var l=t.srcElement||t.target;l!=n.$input&&l!=n.$ico&&(n.hide(),v(i,"click",e))}function t(){v(i,"click",e),d(i,"click",e)}var n=this,i=document.getElementsByTagName("body")[0];n._f12=t,t()},_f13:null,_f11:function(){var e=this,t=e.getValue();e._f13!==t&&(e._f13=t,e.options.callback(t,c(e.$input.value)))}},f});